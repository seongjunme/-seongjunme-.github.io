---
date: '2022-03-08'
title: 'Gatsbyë¡œ ë§Œë“  í¬íŠ¸í´ë¦¬ì˜¤ ì‚¬ì´íŠ¸'
summary: 'Full Pageì˜ ê¸°ëŠ¥ì„ ì¤‘ì ìœ¼ë¡œ í¬íŠ¸í´ë¦¬ì˜¤ì™€ ì‘ì„±í•œ ë¸”ë¡œê·¸ë“¤ì„ ì •ë¦¬í•˜ê¸° ìœ„í•œ ì‚¬ì´íŠ¸'
categories: ['React', 'Gatsby']
thumbnail: './image/gatsby.jpeg'
type: 'Project'
---

### [í”„ë¡œì íŠ¸ repository ë°”ë¡œê°€ê¸°](https://github.com/seongjunme/my-blog)

---

## ğŸ–¥ í”„ë¡œì íŠ¸ ì†Œê°œ

í‰ì†Œì— êµ¬í˜„í•´ë³´ê³  ì‹¶ì—ˆë˜ Full Pageì˜ ê¸°ëŠ¥ì„ ì¤‘ì ìœ¼ë¡œ

í¬íŠ¸í´ë¦¬ì˜¤ì™€ ì‘ì„±í•œ ë¸”ë¡œê·¸ë“¤ì„ ì •ë¦¬í•˜ê¸° ìœ„í•œ ì‚¬ì´íŠ¸

## ğŸ“š ê¸°ìˆ  ìŠ¤íƒ

- React (hooks)

- TypeScript

- Emotion

- Gatsby

- Graphql

## ğŸ›  ì£¼ìš” ê¸°ëŠ¥

- Gatsbyë¥¼ ì´ìš©í•œ ë¸”ë¡œê·¸
- Full Page ì‚¬ì´íŠ¸

## ğŸ‘ ê¸°ìˆ  íŠ¹ì¥ì 

### 1ï¸âƒ£ Graphqlì„ ì´ìš©í•œ Markdown ë°ì´í„° ìš”ì²­

Gatsbyì—ì„œ ì œê³µí•´ì£¼ëŠ” Graphqlì„ ì´ìš©í•˜ì—¬ Markdown ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì–»ê³ , ì´ë¥¼ htmlë¡œ ë³€í™˜í•  ìˆ˜ ìˆë‹¤.
ì´ë¥¼ ìœ„í•´ì„œëŠ” ë¨¼ì € ë‘ ê°€ì§€ í”ŒëŸ¬ê·¸ì¸ì´ í•„ìš”í•˜ë‹¤.

- gatsby-source-filesystem
- gatsby-transformer-remark

í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•œ í›„ gatsby-configì— ë‹¤ìŒê³¼ ê°™ì´ ì‘ì„±í•´ì¤€ë‹¤.

```js
// gatsby-config.js
module.exports = {
  plugins: [
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `contents`,
        path: `${__dirname}/contents`,
      },
    },
    {
      resolve: `gatsby-transformer-remark`,
      options: {
        plugins: [...],
      },
    }
  ],
};

```

#### **gatsby-source-filesystem**

ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì˜ íŒŒì¼ì„ File ë…¸ë“œë¡œ ìƒì„±í•˜ì—¬ graphqlì„ í†µí•´ ë°ì´í„°ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. <br />
ë‹¨, ë§ˆí¬ë‹¤ìš´ì„ pathì— ì§€ì •í•œ ê²½ë¡œì— ì €ì¥í•´ì•¼í•œë‹¤.

#### gatsby-transformer-remark

ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì„ íŒŒì‹±í•˜ì—¬ MarkdownRemark ë…¸ë“œë¡œ ìƒì„±í•œë‹¤.
ìƒì„±ëœ ë…¸ë“œëŠ” graphqlì„ í†µí•´ ë°ì´í„°ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.

<br />

```
query getMarkdownData {
  allMarkdownRemark {
    edges {
      node {
        html
	      id
        frontmatter {
          title,
          summary,
          ...
        }
      }
    }
  }
}
```

<br />

### 2ï¸âƒ£ Gatsbyì˜ slug ê¸°ëŠ¥ì„ ì´ìš©í•˜ì—¬ í•´ë‹¹ Markdown ê²Œì‹œê¸€ê³¼ ì—°ë™

#### slug ìƒì„±

ë§ˆí¬ë‹¤ìš´ ë°ì´í„°ì— slug í•„ë“œë¥¼ ì¶”ê°€í•˜ì—¬ í•´ë‹¹ ê²Œì‹œë¬¼ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ urlì„ ìƒì„±í•œë‹¤.

í•´ë‹¹ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„  onCreateNodeë¼ëŠ” gatsbyì—ì„œ ì œê³µí•˜ëŠ” APIë¥¼ ì‚¬ìš©í•œë‹¤.

<br />

```js
// gatsby-node.js
exports.onCreateNode = ({ node, getNode, actions }) => {
  const { createNodeField } = actions;

  if (node.internal.type === `MarkdownRemark`) {
    const slug = createFilePath({ node, getNode });

    createNodeField({ node, name: 'slug', value: slug });
  }
};
```

<br />
ë§ˆí¬ë‹¤ìš´ ë°ì´í„°ì— í•œí•´ì„œ slug í•„ë“œë¥¼ ì¶”ê°€í•œë‹¤.
ê·¸ë¦¬ê³  slugë°ì´í„°ëŠ” ê²½ë¡œì™€ íŒŒì¼ëª…ì„ ì¡°í•©í•´ ìƒì„±ëœë‹¤.

ex) contents/ShallWeSound.md -> domain/ShallWeSound

#### slugë¥¼ ì´ìš©í•´ í˜ì´ì§€ ìƒì„±

ë§ˆí¬ë‹¤ìš´ ë°ì´í„°ë¥¼ ì´ìš©í•´ slugë¥¼ ìƒì„±í•´ì£¼ì—ˆìœ¼ë‹ˆ, ì´ì œëŠ” ì´ slugë¥¼ ì´ìš©í•´ ì ‘ê·¼í•  í˜ì´ì§€ë¥¼ ìƒì„±í•œë‹¤.
í˜ì´ì§€ ìƒì„±ì€ gatsbyì˜ createPages APIë¥¼ ì´ìš©í•œë‹¤.

<br />

```js
// gatsby-node.js
exports.createPages = async ({ actions, graphql, reporter }) => {
  const { createPage } = actions;

  const queryAllMarkdownData = await graphql(
    `
      {
        allMarkdownRemark {
          edges {
            node {
              fields {
                slug
              }
            }
          }
        }
      }
    `,
  );

  if (queryAllMarkdownData.errors) {
    reporter.panicOnBuild(`Query Error`);
    return;
  }

  const PostTemplateComponent = path.resolve(__dirname, 'src/templates/post.tsx');

  const generatePostPage = ({
    node: {
      fields: { slug },
    },
  }) => {
    const pageOptions = {
      path: slug,
      component: PostTemplateComponent,
      context: { slug },
    };

    createPage(pageOptions);
  };

  queryAllMarkdownData.data.allMarkdownRemark.edges.forEach(generatePostPage);
};
```

<br />

template í´ë”ì— post.tsxë¡œ ê²Œì‹œê¸€ í˜ì´ì§€ì˜ í…œí”Œë¦¿ì„ ì •ì˜í•œë‹¤.
ê·¸ë¦¬ê³  ê·¸ í…œí”Œë¦¿ ì»´í¬ë„ŒíŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.

ë‹¤ìŒìœ¼ë¡œ pageOtionsì„ ì •ì˜í•˜ê³ , ì‹¤ì œë¡œ í˜ì´ì§€ë¥¼ ìƒì„±í•´ì¤„ generatePostPage í•¨ìˆ˜ë¥¼ ì •ì˜í•œë‹¤.
ì—¬ê¸°ì„œ pathëŠ” í˜ì´ì§€ì˜ ê²½ë¡œë¥¼ ë‚˜íƒ€ë‚´ê³ , componentëŠ” ê²Œì‹œê¸€ì„ ë Œë”ë§í•  ì»´í¬ë„ŒíŠ¸ë¥¼ ì˜ë¯¸í•œë‹¤.
ë§ˆì§€ë§‰ìœ¼ë¡œ contextëŠ” ë°”ë¡œ ì•ì„œ ì •ì˜í•œ componentì— propsë¡œ ë„˜ê²¨ì¤„ ìˆ˜ ìˆëŠ” ê°’ì´ë‹¤.
ì´ slugë¥¼ í†µí•´ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ì—ì„œ ë§ëŠ” ë§ˆí¬ë‹¤ìš´ ë¬¸ì„œë¥¼ ì°¾ì•„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë‹¤.

ê·¸ë¦¬ê³  graphqlì„ í†µí•´ ë¶ˆëŸ¬ì˜¨ queryAllMarkdownData ê°’ì—ì„œ markdown ë°ì´í„°ê°€ ë“¤ì–´ìˆëŠ” edgesë¥¼ ë°˜ë³µí•˜ì—¬ í˜ì´ì§€ ìƒì„± í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•´ ì¤€ë‹¤.

### 3ï¸âƒ£ Full Page êµ¬í˜„

#### useFullPageë¼ëŠ” ì»¤ìŠ¤í…€ í›…ì„ ìƒì„± - index.tsx

- ë°˜í™˜ ê°’ìœ¼ë¡œëŠ”
  - ìµœìƒë‹¨ì„ ì§€ì •í•˜ê¸° ìœ„í•œ outerRef
  - í˜„ì¬ ë¶€ë¶„(í˜ì´ì§€)ë¥¼ ì €ì¥í•˜ê¸° ìœ„í•œ currentPageName
  - full page ìƒë‹¨ì˜ navBarë¥¼ í´ë¦­í–ˆì„ ë•Œì˜ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ onClickNavBar

```jsx
// index.tsx
const Index: React.FC = () => {
  const [outerRef, currentPageName, onClickNavBar] = useFullPage({ maxPageCount: 3 });

  return (
    <Background ref={outerRef} className="outer">
      <NavBar currentPageName={currentPageName} onClickNavBar={onClickNavBar} />
      <About />
      <PostList />
      <PostList />
      <Contact />
    </Background>
  );
};
```

#### useFullPage.tsx

- ì¸ìë¡œ í˜ì´ì§€(íŒŒíŠ¸)ì˜ ìµœëŒ€ ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.
  - í˜ì´ì§€ ìˆ˜ëŠ” 0ë¶€í„° ì‹œì‘
- í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ë¥¼ useRefë¡œ ê´€ë¦¬í•œë‹¤.
  - ë²ˆí˜¸ë¥¼ stateë¡œ ê´€ë¦¬í•˜ë©´ ìŠ¤í¬ë¡¤ì„ ì´ë™í•  ë•Œ, stateì˜ ìµœì‹ ê°’ì„ ì‚¬ìš©í•˜ê¸°ê°€ ì–´ë ¤ì›Œì§„ë‹¤.

```jsx
// useFullPage.tsx
const PAGE_NAMES = ['About', 'Project', 'Blog', 'Contact'];

const useFullPage = ({ maxPageCount }: { maxPageCount: number }) => {
  const outerRef = useRef<any>();
  const currentPage = useRef(0);
  const [currentPageName, setCurrentPageName] = useState(PAGE_NAMES[currentPage.current]);

  ...
}
```

#### wheel ë™ì‘ì— ë”°ë¼ currentPageê°€ ê°€ë¦¬í‚¤ëŠ” ë¶€ë¶„ìœ¼ë¡œ ìŠ¤í¬ë¡¤ì„ ì´ë™ì‹œí‚¨ë‹¤.

- ì´ë™ ì‹œí‚¤ëŠ” ê¸°ì¤€ì€ í˜„ì¬ í™”ë©´ í¬ê¸°(window.innerHeight)ì™€ currentPageê°€ ê°€ë¦¬í‚¤ëŠ” ê°’ì´ë‹¤.
- í˜„ì¬ í™”ë©´ í¬ê¸°ê°€ 720pxì´ê³  í˜„ì¬ í˜ì´ì§€ ë²ˆí˜¸ê°€ 0ì¼ ë•Œ topì€ 0ì´ë˜ê³ , í˜ì´ì§€ ë²ˆí˜¸ê°€ 1ì´ë©´ topì€ 720pxì´ ëœë‹¤.
- ì¦‰, 0~720pxì€ í˜ì´ì§€ 0ì´ ì°¨ì§€í•˜ê³ , 720px ~ 1440px ì€ í˜ì´ì§€ 1ì´ ì°¨ì§€í•œë‹¤ëŠ” ëœ»ì´ë‹¤.

```jsx
// useFullPage.tsx
const useFullPage = ({ maxPageCount }: { maxPageCount: number }) => {
  ...

  const scrollToCurrentPage = () => {
    outerRef.current.scrollTo({
      top: window.innerHeight * currentPage.current,
      left: 0,
      behavior: 'smooth',
    });
  };

  const scrollDown = () => {
    currentPage.current += 1;
    scrollToCurrentPage();
    setCurrentPageName(PAGE_NAMES[currentPage.current]);
  };

  const scrollUp = () => {
    currentPage.current -= 1;
    scrollToCurrentPage();
    setCurrentPageName(PAGE_NAMES[currentPage.current]);
  };
}
```

#### outerRefì— ì´ë²¤íŠ¸ ë“±ë¡

- deltaY ê°’ì„ í™•ì¸í•´, wheel ì´ë²¤íŠ¸ê°€ ìœ„ì¸ì§€, ì•„ë˜ì¸ì§€ êµ¬ë¶„í•˜ì—¬ ë™ì‘ì‹œí‚¨ë‹¤.
- debounceë¥¼ ì ìš©í•˜ì—¬ í•œë²ˆì— wheel ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ê°€ ì—°ì†ìœ¼ë¡œ ìˆ˜í–‰ë˜ì§€ ì•Šë„ë¡ í•œë‹¤.
  - ë§ˆìš°ìŠ¤ íœ ì˜ ê²½ìš° êµ‰ì¥íˆ ë¯¼ê°í•˜ê¸° ë•Œë¬¸ì— ì¡°ê¸ˆë§Œ ì›€ì§ì—¬ë„ ìˆ˜ì‹­ê°œì˜ ì´ë²¤íŠ¸ê°€ ë°œìƒí•œë‹¤.
  - ë”°ë¼ì„œ ìŠ¤í¬ë¡¤ í•œë²ˆìœ¼ë¡œ ì²« í˜ì´ì§€ì—ì„œ ë§ˆì§€ë§‰ í˜ì´ì§€ ê¹Œì§€ ë‚´ë ¤ê°€ëŠ” í˜„ìƒì´ ë°œìƒí–ˆê³ , ì´ë¥¼ debounceë¥¼ ì ìš©í•¨ìœ¼ë¡œì¨ í•´ê²°í•˜ì˜€ë‹¤.

```jsx
// useFullPage.tsx
const useFullPage = ({ maxPageCount }: { maxPageCount: number }) => {
  ...

  useEffect(() => {
    const wheelHandler = debounce((e: WheelEvent) => {
      e.preventDefault();

      const { deltaY } = e;

      if (deltaY > 0 && currentPage.current < maxPageCount) {
        scrollDown();
      } else if (deltaY < 0 && currentPage.current > 0) {
        scrollUp();
      }
    }, 50);

    outerRef.current?.addEventListener('wheel', wheelHandler);

    return () => {
      outerRef.current?.removeEventListener('wheel', wheelHandler);
    };
  }, []);
}

```

<br />

```js
// debounce.ts
const debounce = (callback: (...arg: any) => void, delay: number) => {
  let timer: NodeJS.Timeout;

  return (...arg: any) => {
    clearTimeout(timer);
    timer = setTimeout(() => callback(...arg), delay);
  };
};

export default debounce;
```

#### ë§ˆì§€ë§‰ìœ¼ë¡œ ë¸Œë¼ìš°ì € ì°½ì˜ í¬ê¸°ë¥¼ ë³€ê²½í•  ì‹œ, window.innerHeightë¥¼ ë‹¤ì‹œ ê³„ì‚°í•˜ì—¬ í•´ë‹¹ ê°’ì— ë§ê²Œ ìŠ¤í¬ë¡¤ì„ ì´ë™ì‹œì¼œì•¼ í•œë‹¤.

- resize ì´ë²¤íŠ¸ ë°œìƒ ì‹œ, í˜„ì¬ í˜ì´ì§€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìŠ¤í¬ë¡¤ì„ ì´ë™ì‹œì¼œì£¼ëŠ” í•¨ìˆ˜ë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.

```js
// useFullPage.tsx
useEffect(() => {
  window.addEventListener('resize', scrollToCurrentPage);

  return () => {
    window.removeEventListener('resize', scrollToCurrentPage);
  };
});
```
